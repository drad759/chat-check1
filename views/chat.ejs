<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with <%= contactEmail %></title>
    <link rel="stylesheet" href="/styles.css"> <!-- Add general styles -->
    <style>
        /* Global styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #f0f2f5; /* Light gray background for a clean look */
        }

        #intro {
            background: linear-gradient(135deg, #4a90e2, #50e3c2); /* Soothing gradient */
            color: #fff;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border-radius: 0 0 10px 10px; /* Softer corner radius */
            animation: gradientBG 10s ease infinite;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        #intro h1 {
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        .header {
            margin-top: 80px; /* Space for the intro section */
            padding: 15px;
            background-color: #4a90e2; /* Matching header with intro gradient */
            color: #fff;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .header-title {
            font-size: 22px;
            font-weight: bold;
            margin: 0;
        }

        #online-users {
            position: fixed;
            top: 80px; /* Align with #intro */
            right: 10px;
            z-index: 1001;
            background-color: #333; /* Dark background for contrast */
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            color: #fff;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
        }

        .main-content {
            padding: 20px;
            margin-top: 10px;
            margin-bottom: 70px; /* Space for the fixed form at the bottom */
        }

        #messages {
            height: calc(100vh - 150px); /* Adjusted height for the message area */
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sent {
            text-align: right;
        }

        .sent .message {
            background-color: #007bff; /* Bootstrap primary blue */
            color: #fff;
            margin-left: auto;
            margin-bottom: 10px;
            border-radius: 20px;
            padding: 12px;
            max-width: 70%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .received .message {
            background-color: #e9ecef; /* Light gray for received messages */
            color: #333;
            margin-right: auto;
            margin-bottom: 10px;
            border-radius: 20px;
            padding: 12px;
            max-width: 70%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        form {
            background: #fff;
            padding: 15px;
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            align-items: center;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
        }

        form input[type="text"] {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            width: calc(100% - 100px);
            color: #333;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 14px;
        }

        form input[type="file"] {
            display: none; /* Hide the file input */
        }

        form button {
            width: 100px;
            background-color: #28a745; /* Bootstrap success green */
            border: none;
            padding: 10px;
            font-size: 16px;
            color: #fff;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        form button:hover {
            background-color: #218838; /* Darker green for hover */
            transform: scale(1.05);
        }

        footer {
            background: #333;
            color: #fff;
            text-align: center;
            padding: 15px;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
        }

    </style>
</head>
<body>
    <header class="header">
        <h1 class="header-title">Chat with <%= contactEmail %></h1>
    </header>

    <div id="intro">
        <h1>ChatRoom</h1>
    </div>

    <div id="online-users">üôãüèª‚Äç‚ôÇÔ∏è: <span id="online-count">0</span></div>

    <main class="main-content">
        <ul id="messages"></ul>

        <form action="" id="chatForm">
            <input
                id="m"
                type="text"
                placeholder="Enter your message..."
                autocomplete="on"
                required
            />
            <input type="file" id="photo-input" />
            <button type="submit">Send</button>
        </form>
    </main>

   

    <audio id="notificationSound" src="notification.mp3" preload="auto"></audio>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        var socket = io();

        $(function () {
            // Emit event for joining a specific chat room
            socket.emit('join room', '<%= contactEmail %>');

            $("form").submit(function (e) {
                e.preventDefault();
                var message = $("#m").val().trim();
                if (message !== "") {
                    // Send chat message
                    socket.emit('chat message', {
                        contactEmail: '<%= contactEmail %>',
                        message: message
                    });

                    $("#messages").append(
                        '<li class="sent"><div class="message">' +
                            message +
                        "</div></li>"
                    );
                    $("#m").val("");
                }
                return false;
            });

            socket.on('chat message', function (data) {
                $("#messages").append(
                    '<li class="received"><div class="message">' +
                        data.message +
                    "</div></li>"
                );
            });

            socket.on('update user count', function (count) {
                document.getElementById("online-count").innerHTML = count;
            });

            socket.on('user joined', function (name) {
                $("#messages").append(
                    '<li class="joining"><div class="message">' +
                        name +
                        " has joined the chat</div></li>"
                );
            });

            socket.on('user left', function (name) {
                $("#messages").append(
                    '<li class="left"><div class="message">' +
                        name +
                        " has left the chat</div></li>"
                );
            });

            socket.on('receivePhoto', (filePath) => {
                const img = document.createElement("img");
                img.src = `/uploads/${filePath}`;
                img.style.maxWidth = "100%"; /* Responsive image */
                img.style.borderRadius = "10px";
                img.style.margin = "10px 0";
                document.getElementById("messages").appendChild(img);
            });
        });
    </script>
</body>
</html>
